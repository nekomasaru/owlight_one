# Critical User Stories (User Flows)

## 1. オンボーディングとアイデンティティ確立 (Identity & Role)

ユーザーがシステムへの帰属意識を持ち、自分の役割を認識するためのフローです。

### STORY-01: AIによるロールモデル診断

**As a (新規ユーザー)**
組織に参加したばかりの私は、
**I want to (AI対話形式の診断ウィザードを受けたい)**
**So that (自分の強みや組織内でのキャラクター（フクロウのタイプ）を明確にし、自信を持って活動を開始できるため)**

* **Acceptance Criteria (完了条件):**
* 5〜10問の質問に対する回答が Vertex AI に送信されること。
* Vertex AI が回答を分析し、定義済みの「ロール（例：革新的な開拓者）」のいずれかを返却すること。
* 診断完了後、ダッシュボードに自分の「ロールバッジ」が表示されること。
* 初期の成長データ（0ポイント）が作成されること。



---

## 2. 知の探索と活用 (Discovery & Search)

OWLightの核心機能。Vertex AIの検索能力とSupabaseのデータ管理を融合させます。

### STORY-02: 自然言語によるハイブリッド検索

**As a (ナレッジを探すユーザー)**
業務上の課題解決策を知りたい私は、
**I want to (「XXのベストプラクティスは？」のような自然言語で検索したい)**
**So that (キーワードが正確にわからなくても、文脈に合った信頼性の高い情報を入手できるため)**

* **Acceptance Criteria:**
* 入力キーワードに対して Vertex AI から「サジェスト候補」が表示されること。
* Vertex AI Search が算出したランキング順（IDリスト）通りに検索結果が並ぶこと。
* 表示されるタイトル・著者・本文は Supabase の最新データであること。
* 評価スコアが高い記事には「Gold Tier/Best Practice」バッジが表示され、信頼性が一目でわかること。
* 検索結果トップに AI Answer（要約回答）が表示されること。



---

## 3. 知の共有と称賛の循環 (Contribution & Praise)

暗黙知を形式知に変え、それが評価される仕組みです。

### STORY-03: ナレッジの作成と即時同期

**As a (ナレッジ投稿者)**
自分の得た知見を共有したい私は、
**I want to (Markdownエディタで記事を書き、タグを付けて公開したい)**
**So that (同僚の役に立ち、かつ自分の「知の貢献」として記録されるため)**

* **Acceptance Criteria:**
* タイトル、本文、タグを入力して保存できること。
* 保存されたデータが Supabase に格納されること。
* 保存後、バックグラウンド処理で Vertex AI のインデックスに同期されること。



### STORY-04: ピアボーナス（称賛）の送付

**As a (ナレッジを読んだユーザー)**
記事が非常に役に立ったと感じた私は、
**I want to (著者に「称賛メッセージ」と「ポイント」を送りたい)**
**So that (感謝の気持ちを伝え、著者の組織内評価（スコア）を向上させることができるため)**

* **Acceptance Criteria:**
* 記事詳細画面から「称賛ボタン」を押下できること。
* ポイント（例: 10pt）とメッセージを送信できること。
* 送信後、著者の累積ポイントが増加し、該当記事の `evaluation_score` が加算されること。
* スコア更新が Vertex AI に連携され、次回の検索順位に影響を与えること。



---

## 4. 成長の可視化 (Growth Visualization)

モチベーション維持のための機能です。

### STORY-05: 成長タイムラインの確認

**As a (成長志向のユーザー)**
自分の頑張りを確認したい私は、
**I want to (過去のポイント獲得推移をグラフで確認し、同期平均と比較したい)**
**So that (自分の成長を客観的に実感し、次の学習へのモチベーションを維持できるため)**

* **Acceptance Criteria:**
* ダッシュボードに折れ線グラフが表示されること。
* 「自分のスコア推移」と「同期（または同ロール）の平均推移」が重なって表示されること。
* 期間（1ヶ月、3ヶ月、半年）を切り替えられること。



---

## 5. 心理的安全性 (Sanctuary)

OWLight独自の特徴である「逃げ場」の提供です。

### STORY-06: 隠れ家チャットでのガス抜き

**As a (ストレスを抱えたユーザー)**
誰にも言えない愚痴や悩みを吐き出したい私は、
**I want to (ログが一切残らないAIチャット（隠れ家）で会話したい)**
**So that (後で誰かに見られる心配をせずに、心の重荷を下ろして精神衛生を保つため)**

* **Acceptance Criteria:**
* ウィジェットを開くとチャットが開始できること。
* AI（Gemini）が共感的・受容的なトーンで応答すること。
* ブラウザのリロードやウィジェットを閉じる操作で、会話履歴が完全に消滅すること（DB保存なし）。



### STORY-07: 緊急SOSの発信

**As a (危機的状況にあるユーザー)**
ハラスメントやメンタル不調で限界を感じている私は、
**I want to (SOSボタンを長押しして、管理者にアラートを送りたい)**
**So that (直接言い出しにくい状況でも、助けを求めるシグナルを送ることができるため)**

* **Acceptance Criteria:**
* ボタンを3秒間長押しするインタラクションで送信されること（誤送信防止）。
* 送信完了のフィードバックがユーザーに返ること。
* 管理者に即座に通知が届くこと。
* 「匿名送信」を選択した場合、通知詳細で送信者が特定されないこと。



---

### 開発・実装の優先順位

1. **Search & Contribution (STORY-02, 03)**: これがないとナレッジベースとして機能しないため最優先。
2. **Onboarding (STORY-01)**: ユーザー体験の入り口として必要。
3. **Sanctuary (STORY-06, 07)**: アプリの「思想」を体現する差別化機能。
4. **Growth & Praise (STORY-04, 05)**: 継続利用を促すためのループ機能。