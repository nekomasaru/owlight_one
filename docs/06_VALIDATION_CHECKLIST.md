# 06_VALIDATION_CHECKLIST.md

## 概要

OWLightのリリース前に実施すべき品質保証（QA）項目のリストです。
特に「Vertex AI によるランキング決定」と「Supabase による正確な情報表示」の統合部分を入念に検証します。

## 1. 機能検証 (Functional Testing)

### A. 認証・ユーザー管理 (Auth)

* [ ] **新規登録**: メールアドレス/パスワードで登録でき、確認メールが届くこと。
* [ ] **ログイン**: 正しい認証情報でログインでき、セッションが維持されること。
* [ ] **MFA**: 設定済みの場合、2要素認証を通過しないとログインできないこと。
* [ ] **プロフィール編集**: アバター、表示名、Bioの変更が即時反映されること。
* [ ] **ロールモデル診断**: Vertex AI が回答を分析し、適切なロールIDを返すこと。

### B. ナレッジ・検索 (Search & RAG)

* [ ] **ハイブリッド検索ロジック**:
* [ ] 検索結果の**順序**が、Vertex AI から返却されたIDリスト順であること。
* [ ] 検索結果の**内容**（タイトル、著者、本文抜粋）が、Supabase の最新データと一致していること。


* [ ] **スコア反映**: `evaluation_score` が高い記事が、検索結果の上位（または強調表示）になりやすいこと。
* [ ] **AI Answer**: 検索結果トップの要約が生成され、その内容が検索結果と矛盾していないこと。
* [ ] **タグフィルタ**: Supabase側のタグで絞り込みができること。

### C. 評価・成長 (Growth & Praise)

* [ ] **ピアボーナス送付**:
* [ ] 送信後、Supabase の `peer_rewards` と受信者の `total_wisdom_points` が更新されること。
* [ ] 関連するナレッジの `evaluation_score` が加算されること。


* [ ] **成長グラフ**: 自分と同期平均の比較線が正しく描画されること。

### D. サンクチュアリ (Safety)

* [ ] **隠れ家チャット**: 会話履歴がリロード後に完全に消えている（DBに残っていない）こと。
* [ ] **SOS送信**: 3秒長押しで送信され、管理者への通知レコードが作成されること。
* [ ] **匿名性**: 匿名送信の場合、UI上で送信者が特定できないこと。

## 2. セキュリティ検証 (Security Validation)

* [ ] **RLS (Row Level Security)**:
* [ ] 他人の非公開データ（評価詳細、通知）にAPI経由でアクセスできないこと。


* [ ] **XSS対策**: Markdownレンダリング時に悪意あるスクリプトが無害化されていること。
* [ ] **API権限**: 一般ユーザーが `/api/v1/admin` 以下のエンドポイントを実行できないこと。

## 3. Vertex AI 連携検証 (AI Quality)

* [ ] **データ同期**:
* [ ] ナレッジを新規作成・更新した後、一定時間内にVertex AIのインデックス検索でヒットするようになること。
* [ ] ナレッジのスコアが更新された後、Vertex AIのメタデータも更新されていること（検索順位への影響確認）。


* [ ] **ハルシネーション**: AI Answer が、検索ヒットしていない架空の記事を引用していないか。
* [ ] **プロンプト**: 管理画面でプロンプトを修正すると、AIチャットや診断の応答が変化すること。

## 4. アクセシビリティ検証 (Accessibility / a11y)

* [ ] **キーボード操作**: 検索結果のリストをTabキーで移動し、Enterで詳細へ遷移できること。
* [ ] **フォーカス可視性**: すべての操作可能要素にフォーカスリングが表示されること。
* [ ] **コントラスト比**: `axe-core` チェックでWCAG AA基準を満たすこと。
* [ ] **スクリーンリーダー**: 画像のみのボタン（SOS等）に `aria-label` があること。

## 5. パフォーマンス検証 (Performance)

* [ ] **LCP (Largest Contentful Paint)**: ダッシュボードの主要コンテンツが2.5秒以内に表示されること。
* [ ] **検索レイテンシ**:
* [ ] Vertex AI からのID取得 → Supabase からのデータ取得 → 統合表示 の一連の流れがユーザーにストレスを与えない速度であること。
* [ ] 処理中は適切なローディングスケルトンが表示されること。
