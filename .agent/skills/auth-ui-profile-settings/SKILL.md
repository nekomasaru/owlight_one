name: "auth-ui-profile-settings"

description: "ユーザーのアバター画像変更や表示名、自己紹介文（Bio）の編集を行うための設定画面UIコンポーネントを実装する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "user-settings", "ui-component"]

triggers:

&nbsp; - "プロフィール設定"

&nbsp; - "アバター変更"

&nbsp; - "Profile UI"

---



\## 概要



ユーザーがシステム内で他者にどのように表示されるかを管理するための「プロフィール設定画面」を実装します。

現在の登録情報を表示し、表示名（Display Name）、自己紹介（Bio）、およびアバター画像を変更する機能を提供します。特にアバターは、OWLightにおける「フクロウ」としてのアイデンティティや、実際の顔写真などをユーザーが選択できるようにし、画像アップロード時のプレビュー機能も含めた直感的なUIを構築します。







\## このスキルが前提とするもの



\- `users` テーブルおよび認証セッション管理（`auth-api-session`）が機能していること

\- アバター画像保存用の Supabase Storage バケット（`avatars`）が利用可能であること

\- UI ガイドライン（Teal #218F8D）および共通コンポーネント（Input, Textarea, Button, Avatar）が利用可能であること



\## 実装内容



\### UI 実装



\*\*コンポーネント：ProfileSettingsForm.tsx\*\*



\- \*\*機能\*\*: プロフィール情報の編集フォーム

\- \*\*状態管理\*\*: `React Hook Form` 等を使用し、フォームの値を管理。

\- \*\*入力項目\*\*:

&nbsp; - \*\*Avatar\*\*: `AvatarUploader` コンポーネントを使用。

&nbsp; - \*\*Display Name\*\*: テキスト入力（必須、最大50文字）。

&nbsp; - \*\*Bio\*\*: 複数行テキストエリア（最大200文字）。自己紹介や専門分野を記載。

\- \*\*アクション\*\*:

&nbsp; - 「変更を保存」ボタン（変更がある場合のみ活性化）。

&nbsp; - 保存成功時にトースト通知（"プロフィールを更新しました"）を表示。



\*\*コンポーネント：AvatarUploader.tsx\*\*



\- \*\*機能\*\*: 画像選択とプレビュー

\- \*\*UI要素\*\*:

&nbsp; - 現在のアバター画像を円形で表示。

&nbsp; - 画像上のオーバーレイまたは横に「変更」ボタン（カメラアイコン等）。

&nbsp; - ファイル選択ダイアログ（`input type="file"`）。

\- \*\*動作\*\*:

&nbsp; - ファイル選択時に即座にローカルプレビューを表示。

&nbsp; - バリデーション（ファイルサイズ 2MB以下、形式 jpeg/png）。



\*\*画面レイアウト\*\*



\- 配置: 「設定（Settings）」ページ内の「プロフィール」タブ、または独立したページ。

\- デザイン:

&nbsp; - カード形式で情報をグループ化。

&nbsp; - アバター設定を視覚的に目立たせ、その下にテキスト入力フィールドを配置。



\## 参考資料



\- `/docs/03\_SCREEN\_DESIGN.md` （設定画面のデザイン）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （フォームバリデーションとフィードバックの指針）

\- `/docs/04\_API\_SPECIFICATION.md` （ユーザー更新APIの仕様 ※Supabase SDK直接利用の場合もあり）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `ProfileSettingsForm.tsx` が表示され、初期値として現在のユーザー情報が入っていること

\- \[ ] 表示名（Display Name）を変更して保存できること

\- \[ ] 自己紹介（Bio）を変更して保存できること

\- \[ ] `AvatarUploader.tsx` で新しい画像を選択し、プレビューが表示されること

\- \[ ] 画像アップロードを含む保存処理が正常に完了し、アバターが更新されること

\- \[ ] 保存中（Loading）にボタンが無効化され、スピナー等が表示されること

\- \[ ] 入力バリデーション（文字数超過、画像サイズ超過）が機能すること

\- \[ ] モバイル端末でも画像選択と入力がスムーズに行えること



\## 補足・注意事項



\- 画像のアップロード処理は、まずStorageに画像を上げ、返ってきたパブリックURLを `users` テーブルの `avatar\_url` に保存する2段階のプロセスになります。

\- アバター画像のキャッシュ更新ラグを防ぐため、画像のURLにタイムスタンプを付与するなどの対策を検討してください。

