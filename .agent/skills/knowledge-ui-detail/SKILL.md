name: "knowledge-ui-detail"
description: "リッチでコラボレーティブなナレッジ詳細画面 (V2) を実装するためのパターン定義。"

# ナレッジ詳細 UI ガイドライン

このスキルは、ナレッジ詳細画面 (`/knowledge/[id]`) を静的な閲覧ビューから、コラボレーションのためのハブへと変革するための実装パターンを定義します。

## 1. コア原則 (Core Principles)
- **カードベースの階層構造 (Card-Based Hierarchy)**:
  - テキストをただ流し込むのではなく、`Card` コンポーネントを使用して「概要」「背景・コンテキスト」「根拠法令」「具体例」を明確に区分けすること。
- **アクション重視 (Action-Oriented)**:
  - アクションバー（編集、コピー、共有）は常に目立つ場所に配置すること。
- **エンゲージメント・ファースト (Engagement-First)**:
  - 「感謝（ハート）」ボタンは重要なユーザーアクションであり、おまけではない。

## 2. コンポーネント構成 (Component Structure)

### アクションバー (`KnowledgeActions`)
- **配置**: ページ上部、またはスティッキーヘッダー。
- **アクション**:
    - **編集 (Edit)**: `/knowledge/edit/[id]` へのリンク（`user.id === knowledge.author_id` の場合のみ表示）。
    - **リンクコピー (Copy Link)**: 現在のURLをクリップボードにコピー（`navigator.clipboard.writeText`）。トースト通知を出すこと。
    - **共有 (Share)**: 将来的な外部連携用のドロップダウンメニュー。

### 視覚的階層 (`page.tsx`)
1.  **ヘッダー**: タイトル (H1)、ティアバッジ (Gold/Silver/Bronze)、タグ、メタデータ。
2.  **概要カード**: 薄い背景色で強調表示。
3.  **本文セクション**: Markdownレンダリングされた本文。
4.  **構造化カード**:
    - **背景・根拠**: 法令リスト、社内規程リスト。
    - **具体例**: "Good Case" カード。
    - **失敗例**: "Caution" ブロック。

### インセンティブ表示 (Contribution Incentive)
- **非Goldティアの場合**:
  - ページ上部または目立つ位置に「貢献チャンス」カードを表示する。
  - メッセージ例: 「このナレッジを補足・改善してGoldティアに育てましょう。貢献するとWisdom Pointsが獲得できます。」
  - アクション: 編集画面への誘導ボタン。

### エンゲージメントフッター (`KnowledgeEngagement`)
- **感謝ボタン**:
    - アイコン: `<Heart />` (Lucide)。
    - アニメーション: クリック時にパルスアニメーションまたは色変化。
    - カウンター: アイコンの横に現在の数を表示。

### コラボレーション (`KnowledgeComments`)
- **レイアウト**: メインコンテンツの下にコメントリストを配置。
- **ベストアンサー**: ベストアンサーに指定されたコメントを金色の枠またはバッジで強調。
- **フォーム**: シンプルなテキストエリアと「送信」ボタン。

## 3. データフロー (Data Flow)
- **取得**: Supabase から `knowledge` データを取得 (`single()`)。
- **コメント/いいね**: バックエンドテーブルがまだ存在しない場合でも、**Optimistic UI（楽観的UI）** を使用し、ローカルステートで即座に反応を返すこと。
