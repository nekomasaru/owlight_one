name: "auth-ui-login"
description: "ユーザー認証のためのログイン画面UIを実装し、メール/パスワードおよびMFA（TOTP）入力フォームを提供する。"
version: "1.0.0"
author: "OWLight Development Team"
tags: ["feature", "auth", "ui-component"]
triggers:
  - "ログイン画面"
  - "MFAフォーム"
  - "認証UI"
---

## 概要

OWLight のエントランスとなるログイン画面を実装します。
Supabase Auth API と連携し、メールアドレス・パスワードによる基本認証に加え、セキュリティ強化のための多要素認証（TOTP）入力フローもサポートするUIコンポーネントを作成します。

## このスキルが前提とするもの

- `auth-api-session` スキルにより、認証API（`POST /api/v1/auth/login` 等）が実装済みであること
- `UserContext` が実装され、アプリケーション全体に提供されていること
- UI ガイドライン（Teal #218F8D）に基づいた共通コンポーネント（ボタン、入力フィールド等）が利用可能であること

## 実装内容

### UI 実装

**コンポーネント：LoginForm.tsx**

- 機能：メールアドレスとパスワードによるログイン
- 入力項目：
  - Email（必須、メール形式バリデーション）
  - Password（必須、伏せ字）
- ボタン：「ログイン」（`isLoading` 時にローディングスピナー表示）
- エラー表示：認証失敗時に赤文字でメッセージ表示（例：「メールアドレスまたはパスワードが間違っています」）

**コンポーネント：MfaVerifyForm.tsx**

- 機能：TOTPコード（6桁）の入力と検証
- 表示条件：ログイン成功後、ユーザーがMFA有効化済みの場合に表示
- 入力項目：6桁の数値コード
- ボタン：「認証」（自動フォーカス推奨）

**画面レイアウト（LoginPage.tsx）**

- デザイン：中央揃えのカード形式（シャドウ付き）
- 背景：OWLightのブランドカラー（Teal）または落ち着いたグラデーション
- ロゴ：OWLightロゴを上部に配置
- レスポンシブ：モバイルでは全幅表示、PCでは幅400px程度のカード

### 状態管理・遷移フロー

1. **初期状態**: `LoginForm` を表示
2. **ログイン実行**: `POST /api/v1/auth/login` をコール
3. **MFA要求時**: レスポンスで `mfa_required: true` が返った場合、`MfaVerifyForm` に切り替え
4. **完了**: 認証成功後、ダッシュボード（`/dashboard`）または朝の儀式（`/ritual/morning`）へリダイレクト

## 参考資料

- `/docs/03_SCREEN_DESIGN.md` （ログイン画面のデザインスペック）
- `/docs/05_UI_UX_GUIDELINES.md` （フォーム部品とカラーパレット）
- `/docs/04_API_SPECIFICATION.md` （認証APIのレスポンス仕様）

## チェックリスト

実装完了時に、以下をすべて確認：

- [ ] `LoginForm.tsx` を実装し、メール/パスワード入力が可能であること
- [ ] ログインボタン押下時に `POST /api/v1/auth/login` を呼び出していること
- [ ] API エラー時（401等）に適切なエラーメッセージを表示していること
- [ ] ローディング状態（ボタンの無効化・スピナー）が正しく機能すること
- [ ] `MfaVerifyForm.tsx` を実装し、6桁コード入力が可能であること
- [ ] 認証成功後に `/dashboard` 等へ正しくリダイレクトすること
- [ ] UI ガイドライン（Teal #218F8D）に準拠したデザインであること
- [ ] モバイル画面（375px等）での表示崩れがないこと

## 補足・注意事項

- パスワードリセット機能へのリンク（「パスワードをお忘れですか？」）は、本スキル範囲外（別タスク）としますが必要に応じてプレースホルダーを置いてください。
- MFA設定自体（QRコード表示など）は設定画面側のスキルで実装するため、本スキルでは「入力・検証」のみを扱います。
