name: "activity-log-ui-post"

description: "活動ログ（庁内掲示板）への新規投稿を行うための、画像アップロード機能付き入力フォームUIを実装する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "activity-log", "ui-component"]

triggers:

&nbsp; - "投稿フォーム"

&nbsp; - "画像アップロードUI"

&nbsp; - "活動報告入力"

---



\## 概要



庁内掲示板に新しい活動を投稿するためのフォームコンポーネントを実装します。

テキストによるメッセージ入力に加え、イベントや活動の様子を伝えるための画像を添付できる機能（ファイル選択、プレビュー表示）を備えます。投稿処理中はローディング状態を表示し、送信完了後にはフォームをリセットしてフィードを更新するトリガーを引きます。



\## このスキルが前提とするもの



\- `activity-log-api-feed` スキルにより、投稿API (`POST /api/v1/activity-logs`) が実装済みであること

\- 画像アップロード用のユーティリティ（またはSupabase Storage SDK）が利用可能であること

\- UI ガイドライン（Teal #218F8D）および共通コンポーネント（Textarea, Button, IconButton）が利用可能であること



\## 実装内容



\### UI 実装



\*\*コンポーネント：ActivityPostForm.tsx\*\*



\- 機能：新規活動ログの入力と送信

\- 入力項目：

&nbsp; - \*\*本文エリア\*\*: 複数行テキスト入力（プレースホルダー：「今日はどんな活動がありましたか？」）

&nbsp; - \*\*画像添付ボタン\*\*: クリップまたは画像アイコン。クリックでファイル選択ダイアログを開く。

&nbsp; - \*\*画像プレビュー\*\*: 選択された画像がある場合、サムネイルと「削除（×）」ボタンを表示。

&nbsp; - \*\*送信ボタン\*\*: 「投稿する」（本文が空、または送信中は disabled）

\- 動作：

&nbsp; 1. ユーザーがテキスト入力および画像選択。

&nbsp; 2. 画像がある場合、まず Storage へアップロードして URL を取得（またはAPI側でMultipart対応ならそのまま送信）。

&nbsp; 3. `POST /api/v1/activity-logs` をコール。

&nbsp; 4. 成功時、フォームをクリアし、親コンポーネント（フィード）に更新を通知。



\*\*画面レイアウト\*\*



\- 配置：`ActivityPage` の最上部（フィードリストの上）

\- スタイル：カード形式で、背景色を目立たせる（薄いグレーまたは白）

\- レスポンシブ：モバイルでは画面幅一杯、PCではフィードと同じ幅



\### インタラクション設計



\- \*\*ドラッグ＆ドロップ\*\*: フォームエリアへの画像ドラッグ＆ドロップに対応（推奨）。

\- \*\*バリデーション\*\*:

&nbsp; - ファイル形式: jpg, png, webp

&nbsp; - サイズ制限: 5MB以下（超える場合はアラート表示）

&nbsp; - 本文: 必須入力



\## 参考資料



\- `/docs/03\_SCREEN\_DESIGN.md` （掲示板投稿フォームのデザイン）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （フォームのユーザビリティ基準）

\- `/docs/04\_API\_SPECIFICATION.md` （投稿APIのI/F）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `ActivityPostForm.tsx` が実装され、画面に表示されること

\- \[ ] テキスト入力ができ、空の時は送信ボタンが無効化されること

\- \[ ] 画像ファイルを選択でき、プレビューが表示されること

\- \[ ] 画像の「削除」ボタンでプレビューが消えること

\- \[ ] 送信ボタン押下時に API リクエストが送信されること

\- \[ ] 画像付きの投稿が正常に完了し、データベースに `image\_url` が保存されること

\- \[ ] 送信中（Loading）のインジケータが表示されること

\- \[ ] 送信完了後にフォームがリセットされること



\## 補足・注意事項



\- 画像アップロード処理は、Supabase Storage を使用する場合、クライアントサイドで直接アップロードしてURLを取得するフローが一般的ですが、セキュリティ要件に応じてバックエンド経由（署名付きURL等）を選択してください。

\- 投稿完了後のフィード更新は、SWRの `mutate` 関数などを使用して、リロードなしで即座に新しい投稿が表示されるようにしてください。

