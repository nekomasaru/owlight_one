name: "notify-ui-bell"

description: "ヘッダーに配置されるベルアイコンと、リアルタイム更新される未読バッジおよび通知ドロップダウンUIを実装する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "notify", "ui-component"]

triggers:

&nbsp; - "ベル通知"

&nbsp; - "未読バッジ"

&nbsp; - "ドロップダウン"

---



\## 概要



アプリケーションのヘッダー（ナビゲーションバー）に常駐し、新しい通知をユーザーに知らせるUIコンポーネントを実装します。

`notify-api-realtime` で実装したサブスクリプションフックを利用し、新しい通知が来たら即座にバッジの数字を更新し、ベルをクリックすると通知一覧がドロップダウン形式で表示されるようにします。



\## このスキルが前提とするもの



\- `notify-api-realtime` スキル（`useNotificationSubscription` フック）が実装済みであること

\- `notifications` テーブルが存在し、データ取得API（またはSupabaseクライアントでの直接取得）が可能であること

\- UI ガイドライン（Teal #218F8D）および共通コンポーネント（Popover/Dropdown, Badge）が利用可能であること



\## 実装内容



\### UI 実装



\*\*コンポーネント：NotificationBell.tsx\*\*



\- 機能：ベルアイコンの表示と未読管理

\- 表示：

&nbsp; - 未読がある場合：ベルアイコンの右上に赤いバッジ（数値またはドット）を表示

&nbsp; - 未読がない場合：通常のベルアイコン

\- 動作：クリックで `NotificationDropdown` をトグル表示



\*\*コンポーネント：NotificationDropdown.tsx\*\*



\- 機能：通知一覧のリスト表示

\- 内容：

&nbsp; - ヘッダー：「通知」タイトル、「すべて既読にする」ボタン

&nbsp; - リスト：`NotificationItem` の一覧（スクロール可能）

&nbsp; - エンプティステート：「新しい通知はありません」

\- 動作：表示された時点で、リスト内の通知を「既読」にする処理（またはクリック時に既読化）



\*\*コンポーネント：NotificationItem.tsx\*\*



\- 機能：個別の通知カード

\- 表示項目：アイコン（タイプ別）、タイトル、本文（短縮）、時間（相対表記）

\- アクション：クリックで該当リンク（`link\_url`）へ遷移



\### 状態管理



\- \*\*Realtime連携\*\*: `useNotificationSubscription` を使用して、新しい通知が来たらローカルの未読カウントをインクリメントし、リストの先頭に追加。

\- \*\*既読管理\*\*: ドロップダウンを開いたタイミング、または「すべて既読」ボタン押下時に `UPDATE notifications SET is\_read = true` を実行。



\## 参考資料



\- `/docs/14\_OWLIGHT\_BELL\_NOTIFICATIONS.md` （通知UIの仕様）

\- `/docs/03\_SCREEN\_DESIGN.md` （ヘッダーデザイン）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （ドロップダウンのスタイル）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `NotificationBell.tsx` がヘッダーに配置され、未読件数がバッジ表示されること

\- \[ ] リアルタイムで通知（INSERTイベント）を受信し、バッジの数字が増えること

\- \[ ] ベルクリックでドロップダウンが開き、通知リストが表示されること

\- \[ ] 通知をクリックすると、指定されたURLへ遷移すること

\- \[ ] 「すべて既読にする」ボタンが機能し、バッジが消えること

\- \[ ] モバイル画面でもドロップダウンが画面外にはみ出さないこと

\- \[ ] 通知タイプ（感謝、コメント等）に応じたアイコンが表示されること



\## 補足・注意事項



\- 既読処理のタイミングはUXに大きく影響します。今回は「ドロップダウンを開いた時点でバッジは消すが、未読スタイル（背景色など）はクリックするまで残す」等の挙動を推奨します。

\- 通知音（Sound）は、業務システムの特性上、デフォルトOFFにするか、控えめな音に設定してください。

