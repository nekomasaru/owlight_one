name: "error-ui-boundary"

description: "React Error Boundaryを活用し、アプリケーション全体の予期せぬエラーを捕捉してユーザーフレンドリーなエラー画面を表示する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "error-handling", "ui-component"]

triggers:

&nbsp; - "エラー画面"

&nbsp; - "Error Boundary"

&nbsp; - "Global Error"

---



\## 概要



アプリケーション実行中に予期せぬエラーが発生した際、画面が白くなる（ホワイトアウト）のを防ぎ、ユーザーに状況を伝えて復帰を促すためのエラー画面を実装します。

Next.js App Routerの `error.tsx` および `not-found.tsx` を使用し、エラーの内容に応じたメッセージ表示と、「再読み込み」「ホームへ戻る」といったアクションボタンを提供します。また、開発環境と本番環境で表示する情報の詳細度を切り替えます。







\## このスキルが前提とするもの



\- Next.js (App Router) プロジェクトの基盤が整っていること

\- UI ガイドライン（Teal #218F8D）および共通コンポーネント（Button）が利用可能であること

\- アイコンライブラリ（Lucide React の `AlertTriangle` 等）が導入されていること



\## 実装内容



\### UI 実装



\*\*コンポーネント：error.tsx (App Router Standard Error)\*\*



\- \*\*機能\*\*: ルートセグメントまたは特定の機能セグメントでのエラー捕捉。

\- \*\*Props\*\*: `error: Error \& { digest?: string }`, `reset: () => void`

\- \*\*UI要素\*\*:

&nbsp; - \*\*アイコン\*\*: フクロウが困っている様子、または警告アイコン（Teal色）。

&nbsp; - \*\*タイトル\*\*: "Something went wrong!"（「予期せぬエラーが発生しました」）。

&nbsp; - \*\*メッセージ\*\*: エラーの詳細（本番環境では「しばらく時間を置いてから再度お試しください」等の汎用メッセージ）。

&nbsp; - \*\*アクション\*\*:

&nbsp;   - 「再試行する (Try again)」ボタン（`reset()` 関数を実行）。

&nbsp;   - 「ホームに戻る」リンクボタン。

\- \*\*ロジック\*\*: `useEffect` 内でエラーをコンソール（またはSentry等のログ基盤）に出力する。



\*\*コンポーネント：not-found.tsx (404 Page)\*\*



\- \*\*機能\*\*: 存在しないURLにアクセスした際の表示。

\- \*\*UI要素\*\*:

&nbsp; - \*\*タイトル\*\*: "Page Not Found"（「ページが見つかりません」）。

&nbsp; - \*\*メッセージ\*\*: "お探しのナレッジは移動または削除された可能性があります。"

&nbsp; - \*\*アクション\*\*: 「ホームに戻る」リンク、「検索ページへ」リンク。



\*\*画面レイアウト\*\*



\- 配置: 画面中央揃え（Flex Center）。

\- デザイン: ユーザーの不安を和らげるため、イラストや余白を活用した穏やかなデザイン。



\## 参考資料



\- `/docs/03\_SCREEN\_DESIGN.md` （エラーステートおよび404画面のデザイン）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （エラーメッセージのトーン＆マナー）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `app/error.tsx` (または `global-error.tsx`) を実装し、レンダリングエラーを捕捉できること

\- \[ ] `app/not-found.tsx` を実装し、存在しないパスで404画面が表示されること

\- \[ ] 「再試行」ボタンをクリックすると `reset()` が呼ばれ、画面が再描画されること

\- \[ ] 「ホームに戻る」ボタンでトップページへ遷移できること

\- \[ ] モバイル端末でもレイアウトが崩れず、ボタンが押しやすいこと

\- \[ ] エラー発生時に `console.error` 等でログが出力されていること



\## 補足・注意事項



\- `app/global-error.tsx` はルートレイアウト（`<html>` `<body>` タグを含む）のエラーを捕捉する場合に必要ですが、通常のページ遷移内のエラーであれば `app/error.tsx` で十分です。

\- ユーザーに技術的なスタックトレースを見せないよう、本番ビルド時の表示内容には注意してください。

