name: "auth-ui-security"

description: "パスワードの変更および多要素認証（MFA）の有効化状態を切り替えるためのセキュリティ設定UIコンポーネントを実装する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "user-settings", "ui-component"]

triggers:

&nbsp; - "セキュリティ設定"

&nbsp; - "パスワード変更"

&nbsp; - "MFAトグル"

---



\## 概要



ユーザーが自身のアカウントの安全性を管理するための設定画面を実装します。

現在のパスワードを入力して新しいパスワードを設定する変更フォームと、多要素認証（MFA）の利用ステータスを確認・切り替えるためのトグルスイッチ（または設定ボタン）を提供します。MFA設定はSupabase Authの機能を活用し、セキュリティ意識の高いユーザーのニーズに応えます。







\## このスキルが前提とするもの



\- `auth-api-session` スキルにより、認証セッションとユーザー情報の取得が可能であること

\- Supabase Authの設定でMFAが有効化されていること（バックエンド側）

\- UI ガイドライン（Teal #218F8D）および共通コンポーネント（Input, Button, Switch/Toggle）が利用可能であること



\## 実装内容



\### UI 実装



\*\*コンポーネント：SecuritySettings.tsx\*\*



\- \*\*機能\*\*: パスワード変更とMFA管理

\- \*\*セクション1: パスワード変更\*\*

&nbsp; - \*\*入力項目\*\*:

&nbsp;   - 現在のパスワード

&nbsp;   - 新しいパスワード（8文字以上、英数混在などの要件あり）

&nbsp;   - 新しいパスワード（確認）

&nbsp; - \*\*アクション\*\*: 「パスワードを更新」ボタン。

&nbsp; - \*\*フィードバック\*\*: 更新成功時に「パスワードを変更しました」のトースト表示。

\- \*\*セクション2: 多要素認証 (MFA)\*\*

&nbsp; - \*\*ステータス表示\*\*: 現在MFAが有効か無効かを表示。

&nbsp; - \*\*アクション\*\*:

&nbsp;   - 無効時: 「MFAを設定する」ボタン（クリックで登録フロー/モーダルへ）。

&nbsp;   - 有効時: 「MFAを解除する」ボタン（またはトグルOFF）。

&nbsp; - \*\*説明文\*\*: 「ログイン時に認証アプリのコード入力が必要になります」等の補足。



\*\*画面レイアウト\*\*



\- 配置: 「設定（Settings）」ページ内の「セキュリティ」タブ。

\- デザイン:

&nbsp; - 重要な操作のため、各セクションに適度な余白と説明文を配置。

&nbsp; - 危険な操作（解除など）には確認ダイアログを挟む。



\## 参考資料



\- `/docs/03\_SCREEN\_DESIGN.md` （設定画面のデザイン）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （エラーメッセージとパスワード入力のUI）

\- `/docs/04\_API\_SPECIFICATION.md` （Supabase Auth API仕様）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `SecuritySettings.tsx` が表示され、レイアウトが崩れていないこと

\- \[ ] パスワード変更フォームで、現在のパスワードと新しいパスワードを入力できること

\- \[ ] パスワード不一致や強度不足の場合にバリデーションエラーが表示されること

\- \[ ] パスワード更新処理が正常に完了すること

\- \[ ] MFAの現在のステータス（有効/無効）が正しく表示されること

\- \[ ] MFA設定ボタン/トグルが機能すること（※実際の登録フローは別コンポーネント呼び出しでも可）

\- \[ ] UIのアクセシビリティ（タブ操作など）が確保されていること



\## 補足・注意事項



\- パスワード変更には、Supabaseの `updateUser` メソッドを使用します。

\- MFAの新規登録フロー（QRコード表示など）自体が複雑な場合、このスキルでは「設定開始ボタンの配置」と「ステータス表示」までを行い、詳細フローは別スキル（`auth-ui-mfa-enrollment`）として切り出しても構いません。

\- パスワード入力欄には、目のアイコンでの「表示/非表示」切り替え機能を実装してください。

