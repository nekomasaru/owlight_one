name: "sanctuary-ui-sos-button"

description: "心理的安全性確保のため、長押し操作で緊急アラート（SOS）を送信するフローティングボタンUIを実装する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "safety", "ui-component"]

triggers:

&nbsp; - "SOSボタン"

&nbsp; - "緊急ビーコン"

&nbsp; - "長押しUI"

---



\## 概要



ユーザーが精神的に追い詰められた緊急時に、直感的かつ誤操作なく助けを求めるための「SOSビーコンボタン」を実装します。

単なるクリックではなく「3秒間の長押し」をトリガーとすることで、意図しない送信を防ぎつつ、ユーザーに「助けを求める意思決定」の時間を与えます。押下中はプログレスリング等のアニメーションで進行状況を可視化します。







\## このスキルが前提とするもの



\- `sanctuary-api-sos` スキルにより、送信API (`POST /api/v1/safety/sos`) が実装済みであること

\- UI ガイドライン（Teal #218F8D）および共通コンポーネントが利用可能であること

\- アイコンライブラリ（Lucide React の `Zap` や `LifeBuoy` 等）が導入されていること



\## 実装内容



\### UI 実装



\*\*コンポーネント：SOSBeaconButton.tsx\*\*



\- \*\*機能\*\*: 長押し検知付きのアクションボタン

\- \*\*状態管理\*\*:

&nbsp; - `status`: `idle` | `pressing` | `sending` | `sent` | `error`

&nbsp; - `progress`: 0〜100%（押下時間に応じて増加）

\- \*\*UI要素\*\*:

&nbsp; - \*\*ボタン本体\*\*: 目立つが威圧感のないデザイン（例: 警告色の枠線を持つ円形ボタン）。

&nbsp; - \*\*プログレスインジケータ\*\*: ボタン周囲を囲むSVGサークル。長押し中に円が描画される。

&nbsp; - \*\*ラベル\*\*: 通常時は「SOS」、長押し中は「そのまま押し続けて...」。

&nbsp; - \*\*フィードバック\*\*: 送信完了時に「管理者に通知しました」というトーストまたはモーダルを表示。

\- \*\*インタラクション\*\*:

&nbsp; - `onMouseDown` / `onTouchStart`: タイマー開始、プログレスアニメーション開始。

&nbsp; - `onMouseUp` / `onTouchEnd`: タイマーリセット、プログレスリセット（完了前の場合）。

&nbsp; - 3秒経過: API送信トリガー。



\*\*画面レイアウト\*\*



\- 配置: `SanctuaryWidget` のチャットウィンドウ内ヘッダー、または独立したフローティングボタンとして配置。

\- スタイル: 緊急用であることがわかるよう、他の要素とは区別された配色（アクセントカラーのオレンジ等）を使用可能とする。



\## 参考資料



\- `/docs/03\_SCREEN\_DESIGN.md` （SOSボタンの配置とデザイン）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （マイクロインタラクションの指針）

\- `/docs/04\_API\_SPECIFICATION.md` （SOS APIの仕様）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `SOSBeaconButton.tsx` が表示され、クリックだけでは発動しないこと

\- \[ ] 長押し（3秒設定）でプログレスバーがアニメーションすること

\- \[ ] 指を離すとプログレスがリセットされること

\- \[ ] 長押し完了時に `POST /api/v1/safety/sos` がコールされること

\- \[ ] 通信中（Sending）にローディング表示が出ること

\- \[ ] 送信完了後に安心させるメッセージ（例：「メッセージが届きました」）が表示されること

\- \[ ] モバイル端末（タッチ操作）でも長押し判定が正常に動作すること



\## 補足・注意事項



\- 長押し判定には `useRef` と `requestAnimationFrame` または `setTimeout` を組み合わせ、パフォーマンスに配慮した実装を行ってください。

\- 誤操作防止機能（ガード）は必須ですが、緊急時にストレスなく押せるよう、操作はシンプルに保ってください。

\- アクセシビリティ対応として、キーボード操作（例: Spaceキー長押し）も考慮できると理想的です。

