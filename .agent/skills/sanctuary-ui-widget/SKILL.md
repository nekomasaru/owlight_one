name: "sanctuary-ui-widget"

description: "画面右下に常駐し、クリックすると展開する「ログに残らない（Ephemeral）」AIチャットウィジェットを実装する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "safety", "ui-component"]

triggers:

&nbsp; - "隠れ家チャット"

&nbsp; - "Sanctuary Widget"

&nbsp; - "匿名相談UI"

---



\## 概要



心理的安全性機能の中核となる「Sanctuary（隠れ家）」への入り口を実装します。

画面右下に常駐するフローティングアクションボタン（FAB）として配置され、クリックすると小さなチャットウィンドウが展開します。このチャットは「ログがデータベースに保存されない」ことが最大の特徴であり、ユーザーが安心して愚痴や悩みを吐き出せる安全地帯を提供します。







\## このスキルが前提とするもの



\- UI ガイドライン（Teal #218F8D）および共通コンポーネント（Button, Input, Avatar）が利用可能であること

\- アイコンライブラリ（Lucide React 等）が導入されていること



\## 実装内容



\### UI 実装



\*\*コンポーネント：SanctuaryWidget.tsx\*\*



\- \*\*機能\*\*: 常駐型ウィジェットの表示制御

\- \*\*状態\*\*: `isOpen` (boolean)

\- \*\*配置\*\*: `fixed bottom-6 right-6 z-50`

\- \*\*外観\*\*:

&nbsp; - 通常時: ブランドカラー（Teal）の円形ボタン。フクロウまたは吹き出しのアイコン。

&nbsp; - ホバー時: 「隠れ家へ」等のツールチップを表示。

&nbsp; - 展開時: ボタンが「×（閉じる）」アイコンに変化。



\*\*コンポーネント：EphemeralChatWindow.tsx\*\*



\- \*\*機能\*\*: ログ保存なしのチャット画面

\- \*\*状態\*\*: `messages` (Array) - \*\*ローカルステートのみで管理し、リロードや閉じる操作で破棄される\*\*。

\- \*\*UI要素\*\*:

&nbsp; - \*\*ヘッダー\*\*: 「ここでの会話は保存されません」という免責メッセージを目立つように表示。

&nbsp; - \*\*メッセージリスト\*\*: ユーザー（右側）とAI（左側・フクロウアイコン）の吹き出し。

&nbsp; - \*\*入力エリア\*\*: テキスト入力と送信ボタン。

&nbsp; - \*\*リセットボタン\*\*: 会話を明示的に消去するボタン。



\*\*画面レイアウト\*\*



\- 幅: 350px（モバイル時は `w-full`, `bottom-0`, `right-0`）

\- 高さ: 500px（モバイル時は画面の80%程度）



\### インタラクション設計



1\. ボタンクリックでウィンドウがポップアップ（アニメーション付き）。

2\. ユーザーがメッセージ送信 → AIAPI（ストリーミング推奨）へ送信。

3\. AIが「共感」を重視した返答を生成（※AI接続部分はモックまたは `useChat` フックで実装）。

4\. ウィンドウを閉じると、警告ダイアログなしで即座にステートをクリア（「痕跡を残さない」体験の徹底）。



\## 参考資料



\- `/docs/03\_SCREEN\_DESIGN.md` （SanctuaryのUIイメージ）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （FABの配置ルールと配色）

\- `/docs/06\_VALIDATION\_CHECKLIST.md` （心理的安全性・匿名性の要件）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `SanctuaryWidget.tsx` が画面右下に固定表示されること

\- \[ ] クリックでチャットウィンドウが開閉すること（Framer Motion等のアニメーション推奨）

\- \[ ] チャットウィンドウ上部に「保存されない」旨のメッセージが表示されていること

\- \[ ] メッセージの送受信ができること（AI応答はモックでも可）

\- \[ ] ブラウザのリロードまたはウィンドウを閉じた際に、会話履歴が完全に消えること（LocalStorage等にも保存しない）

\- \[ ] モバイル端末（375px）で全画面に近い表示になり、入力が阻害されないこと

\- \[ ] アクセシビリティ（キーボード操作で開閉可能）が考慮されていること



\## 補足・注意事項



\- このウィジェットは「システムへのデータ保存」を絶対に行わないでください。`useEffect` などで意図せずログ送信しないよう注意が必要です。

\- AIの回答生成API自体は、履歴を持たないステートレスなエンドポイント（`POST /api/v1/chat/ephemeral` 等）を使用する想定ですが、本スキルではUIの実装に集中します。

