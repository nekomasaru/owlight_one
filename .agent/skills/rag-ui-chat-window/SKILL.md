---

name: "rag-ui-chat-window"

description: "RAGベースのAIチャットインターフェースを実装し、メッセージの送受信、ストリーミング表示、ローディング状態の管理を行うメイン画面を提供する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "rag", "ui-component"]

triggers:

&nbsp; - "チャット画面"

&nbsp; - "AI対話UI"

&nbsp; - "ストリーミング表示"

---



\## 概要



OWLight のメイン機能である AI チャット画面（Chat Window）を実装します。

ユーザーと AI の対話履歴を表示するリスト、質問を入力するフォーム、そして回答生成中のストリーミング表示（文字が徐々に表示される演出）を統合したコンポーネントです。

Vercel AI SDK (`useChat` フック等) を活用し、バックエンドの `rag-api-chat` とシームレスに連携することで、快適な対話体験を提供します。



\## このスキルが前提とするもの



\- `rag-api-chat` スキルにより、ストリーミング対応のチャット API が実装済みであること

\- UI ガイドライン（Teal #218F8D）および共通コンポーネント（Avatar, Button, Textarea）が利用可能であること

\- `markdown-to-jsx` や `react-markdown` などの Markdown レンダリングライブラリが導入されていること



\## 実装内容



\### UI 実装



\*\*コンポーネント：ChatWindow.tsx\*\*



\- 機能：チャット画面全体のレイアウトと状態管理（Vercel AI SDK `useChat` 推奨）

\- 構成：

&nbsp; - ヘッダー：AI キャラクター（Mr.OWL）とステータス表示

&nbsp; - メッセージエリア：スクロール可能な履歴表示領域

&nbsp; - 入力エリア：下部固定の入力フォーム



\*\*コンポーネント：MessageBubble.tsx\*\*



\- 機能：個々のメッセージ表示

\- スタイル：

&nbsp; - User：右寄せ、Teal 背景、白文字

&nbsp; - Assistant：左寄せ、グレー背景、黒文字、Markdown レンダリング有効

\- 引用表示：Assistant の回答に含まれる引用（Citations）を、クリック可能なリンクまたは脚注として表示



\*\*コンポーネント：ChatInput.tsx\*\*



\- 機能：質問入力フォーム

\- 動作：

&nbsp; - `Ctrl + Enter` (または `Cmd + Enter`) で送信

&nbsp; - 送信中は入力無効化またはキャンセルボタン表示

&nbsp; - テキスト量に応じた自動リサイズ（Textarea Autosize）



\*\*画面レイアウト\*\*



\- 配置：画面中央に配置し、最大幅（max-w-4xl）を設定

\- レスポンシブ：モバイル時は画面下部のナビゲーションバーと被らないようパディング調整

\- スクロール：新しいメッセージ受信時に自動で最下部へスクロール



\## 参考資料



\- `/docs/03\_SCREEN\_DESIGN.md` （チャット画面のデザイン仕様）

\- `/docs/13\_RAG\_CHAT\_ADMIN.md` （会話フローと引用表示の仕様）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （チャットバブルのカラースキーム）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `ChatWindow.tsx` が実装され、メッセージの送受信ができること

\- \[ ] `rag-api-chat` と連携し、AI の回答がストリーミング（1文字ずつ）表示されること

\- \[ ] ユーザーのメッセージが右側、AI のメッセージが左側に正しくスタイルされること

\- \[ ] Markdown（箇条書き、太字等）が正しくレンダリングされること

\- \[ ] 回答生成中にローディングインジケーターが表示されること

\- \[ ] 新しいメッセージが追加された際、自動的に最下部へスクロールすること

\- \[ ] モバイル画面で入力フォームがキーボードに隠れないこと

\- \[ ] エラー時（API 失敗等）にトーストまたはメッセージで通知されること



\## 補足・注意事項



\- ストリーミング表示の実装には `ai` パッケージ（Vercel AI SDK）の `useChat` フックを使用すると、状態管理や自動スクロールが大幅に簡略化できるため推奨します。

\- 引用（Citations）のデータ構造は API レスポンスに依存するため、`rag-api-chat` の出力形式を確認しながら実装してください。

