name: "auth-ui-closing-ritual"

description: "1日の業務を締めくくる振り返り入力と「It's All Right」演出を行う夕方の儀式（Closing Ritual）モーダルUIを実装する。"

version: "1.0.0"

author: "OWLight Development Team"

tags: \["feature", "auth", "ui-component"]

triggers:

&nbsp; - "夕方の儀式"

&nbsp; - "振り返り画面"

&nbsp; - "ClosingRitual"

---



\## 概要



1日の業務終了時に表示される「夕方の儀式」モーダルを実装します。

ポジティブな記憶で一日を終えるための振り返り入力と、脳に「オフ」のスイッチを入れるための視覚的な完了演出（スタンプアニメーションと "It's All Right" メッセージ）を提供します。



\## このスキルが前提とするもの



\- `auth-api-session` スキルにより、ユーザーセッションが利用可能であること

\- `UserContext` が実装済みであること

\- 振り返りデータを保存するためのAPI（`POST /api/v1/engagement/reflection` 等）が、`engage` モジュールで準備されるか、本スキル内でモックAPIとして定義されていること

\- アニメーションライブラリ（Framer Motion等）が導入されていること



\## 実装内容



\### UI 実装



\*\*コンポーネント：ClosingRitualModal.tsx\*\*



\- 機能：1日の振り返りと終了演出を行う全画面オーバーレイ

\- 表示トリガー：ログアウトボタン押下時、または `/closing` へのアクセス

\- 構成要素：

&nbsp; 1. \*\*背景\*\*: 夕焼けから夜空へ変化するグラデーション背景

&nbsp; 2. \*\*問いかけ\*\*: 「今日、誰かの『力』になれましたか？」

&nbsp; 3. \*\*選択肢\*\*: \[はい、なれました] / \[少しはなれたと思います] / \[今日は難しかったです]

&nbsp; 4. \*\*振り返り入力\*\*: 具体的なエピソードを入力するテキストエリア（任意）

&nbsp; 5. \*\*終了演出\*\*: 送信後、大きな「承認」スタンプが押され、画面が暗転して "It's All Right." の文字が表示される



\*\*アニメーション要件\*\*



\- スタンプ：画面奥から手前に「バン！」と押されるようなインパクトのある動き

\- 暗転：メッセージ表示後、ゆっくりとフェードアウトし、完全に真っ暗になる（シャットダウン演出）



\### API 連携（簡易）



\*\*POST /api/v1/engagement/reflection\*\*



\- 説明：振り返り内容を保存し、貢献ポイント（Wisdom Point）を加算する

\- リクエスト：`{ sentiment: "positive" | "neutral" | "negative", comment: string }`

\- レスポンス：`{ success: true, points\_awarded: 50 }`



\## 参考資料



\- `/docs/03\_SCREEN\_DESIGN.md` （夕方の儀式のUI仕様とアニメーション）

\- `/docs/07\_BEHAVIORAL\_DESIGN.md` （ピーク・エンドの法則とクロージングの心理効果）

\- `/docs/05\_UI\_UX\_GUIDELINES.md` （モーダルのスタイルガイド）



\## チェックリスト



実装完了時に、以下をすべて確認：



\- \[ ] `ClosingRitualModal.tsx` が全画面オーバーレイとして実装されていること

\- \[ ] 3つの選択肢に応じた適切なフィードバック（ポジティブ/ネガティブ）が表示されること

\- \[ ] 振り返り入力後、API へデータが送信されること

\- \[ ] 送信成功時にスタンプアニメーションが再生されること

\- \[ ] 最後に "It's All Right." のメッセージと共に画面が暗転すること

\- \[ ] 処理完了後、自動的にログアウト処理（`auth-api-session` のログアウトAPI呼び出し）が行われること

\- \[ ] レスポンシブ対応（スマホでも演出が画面内に収まること）



\## 補足・注意事項



\- 「今日は難しかったです」が選択された場合は、無理にポジティブなコメントを求めず、「ゆっくり休みましょう」等の労いメッセージを表示する優しい設計にしてください。

\- ログアウト処理は、演出が完全に終わってから実行するように `setTimeout` 等でタイミングを制御してください。

